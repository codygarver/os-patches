From 96311def2466dd44de64d77a1c815b22fbf68f71 Mon Sep 17 00:00:00 2001
From: Richard Moore <rich@kde.org>
Date: Mon, 19 Nov 2012 20:48:39 +0000
Subject: [PATCH] Make the rules for redirects a bit stricter.

Change-Id: I7a3cec664aa028202de3d3bda9f499e4deb2998d
Reviewed-by: Lars Knoll <lars.knoll@digia.com>
---
 src/declarative/qml/qdeclarativexmlhttprequest.cpp |    8 +++++---
 1 files changed, 5 insertions(+), 3 deletions(-)

Index: qt4-x11-4.8.1/src/declarative/qml/qdeclarativexmlhttprequest.cpp
===================================================================
--- qt4-x11-4.8.1.orig/src/declarative/qml/qdeclarativexmlhttprequest.cpp	2012-03-14 10:01:13.000000000 -0400
+++ qt4-x11-4.8.1/src/declarative/qml/qdeclarativexmlhttprequest.cpp	2013-02-06 08:19:13.008696604 -0500
@@ -1270,9 +1270,11 @@
         QVariant redirect = m_network->attribute(QNetworkRequest::RedirectionTargetAttribute);
         if (redirect.isValid()) {
             QUrl url = m_network->url().resolved(redirect.toUrl());
-            destroyNetwork();
-            requestFromUrl(url);
-            return;
+            if (url.scheme().toLower() != QLatin1String("file")) {
+                destroyNetwork();
+                requestFromUrl(url);
+                return;
+            }
         }
     }
 
